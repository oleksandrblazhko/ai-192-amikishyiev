# Тестування ін'єкції XPath

## Підсумок

XPath — це мова, яка була розроблена та розроблена переважно для адресації частин документа XML. Під час ін’єкційного тестування XPath ми перевіряємо, чи можливо вставити синтаксис XPath у запит, інтерпретований програмою, дозволяючи зловмиснику виконувати керовані користувачем запити XPath. У разі успішного використання ця вразливість може дозволити зловмиснику обійти механізми автентифікації або отримати доступ до інформації без належної авторизації.</br>

Веб-програми активно використовують бази даних для зберігання та доступу до даних, необхідних для їх роботи. Історично реляційні бази даних були найпоширенішою технологією зберігання даних, але в останні роки ми спостерігаємо зростаючу популярність баз даних, які організовують дані за допомогою мови XML. Так само, як доступ до реляційних баз даних здійснюється через мову SQL, бази даних XML використовують XPath як стандартну мову запитів.

Оскільки, з концептуальної точки зору, XPath дуже схожий на SQL за своїм призначенням і застосуванням, цікавим результатом є те, що атаки ін’єкцій XPath дотримуються тієї ж логіки, що й атаки [ін’єкцій SQL](https://owasp.org/www-community/attacks/SQL_Injection). У деяких аспектах XPath є навіть потужнішим, ніж стандартний SQL, оскільки вся його потужність уже присутня в його специфікаціях, тоді як велика кількість технік, які можна використовувати в атаці SQL-ін’єкції, залежить від характеристик діалекту SQL, який використовує цільова база даних. Це означає, що ін’єкційні атаки XPath можуть бути набагато більш адаптивними та повсюдними. Ще одна перевага ін’єкційної атаки XPath полягає в тому, що, на відміну від SQL, ACL не застосовуються, оскільки наш запит може отримати доступ до кожної частини XML-документа.

## Мета тестуваннь
- Визначте точки ін’єкції XPATH.

## Як тестувати
[Шаблон атаки XPath був вперше опублікований Амітом Кляйном](http://dl.packetstormsecurity.net/papers/bypass/Blind_XPath_Injection_20040518.pdf) і дуже схожий на звичайну SQL-ін’єкцію. Щоб отримати перше розуміння проблеми, уявімо сторінку входу, яка керує автентифікацією в програмі, у якій користувач повинен ввести своє ім’я користувача та пароль. Припустімо, що наша база даних представлена таким файлом XML:
```
<?xml version="1.0" encoding="ISO-8859-1"?>
<users>
    <user>
        <username>gandalf</username>
        <password>!c3</password>
        <account>admin</account>
    </user>
    <user>
        <username>Stefan0</username>
        <password>w1s3c</password>
        <account>guest</account>
    </user>
    <user>
        <username>tony</username>
        <password>Un6R34kb!e</password>
        <account>guest</account>
    </user>
</users>
```
Запит XPath, який повертає обліковий запис із ім’ям користувача **gandalf** та паролем **!c3**, матиме наступний вигляд:
```
string(//user[username/text()='gandalf' and password/text()='!c3']/account/text())
```
Якщо програма не фільтрує належним чином введені користувачем дані, тестувальник зможе ввести код XPath і вплинути на результат запиту. Наприклад, тестувальник може ввести такі значення:
```
Username: ' or '1' = '1
Password: ' or '1' = '1
```
Здається досить знайомим, чи не так? Використовуючи ці параметри, запит виглядатиме так:
```
string(//user[username/text()='' or '1' = '1' and password/text()='' or '1' = '1']/account/text())
```
Як і у звичайній атаці SQL-ін’єкції, ми створили запит, який завжди оцінюється як істинний, що означає, що програма автентифікує користувача, навіть якщо ім’я користувача чи пароль не було надано. І як у звичайній атаці SQL-ін’єкцій, з ін’єкцією XPath першим кроком є вставлення одинарних лапок (**'**) у поле, яке потрібно перевірити, вводячи синтаксичну помилку в запит, і перевірити, чи програма повертає повідомлення про помилку.

Якщо немає інформації про внутрішні деталі XML-даних і якщо програма не надає корисних повідомлень про помилки, які допомагають нам відновити її внутрішню логіку, можна виконати атаку [сліпої ін’єкції XPath](http://dl.packetstormsecurity.net/papers/bypass/Blind_XPath_Injection_20040518.pdf), метою якої є реконструкція всієї структури даних.
</br>Техніка схожа на SQL-ін’єкцію на основі висновків, оскільки підхід полягає у впровадженні коду, який створює запит, який повертає один біт інформації. [Сліпу ін’єкцію XPath](https://owasp.org/www-community/attacks/Blind_XPath_Injection) більш детально пояснює Аміт Кляйн у статті, на яку посилається.


